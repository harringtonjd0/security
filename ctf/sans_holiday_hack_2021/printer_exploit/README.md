# Printer Exploitation

The premise of this challenge is that you have unauthenticated access to a printer's web page, and the goal is to gain shell access to the printer in order to read a specific log file (/var/spool/printer.log).


The printer's web server allows unauthenticated users to perform a firmware update, as well as downloading the current firmware.  The firmware is "signed" by hashing the firmware image along with an unknown secret key of length 16 in order to generate a signature.  You are also given the information that if multiple firmware images are combined, only the final image will be used.  


The firmware comes in a json file when you download it.  This json file contains a base64 encoded copy of the binary firmware image, as well as a signature, which is a sha256 hash of (secret key + firmware image).  Decoding the firmware image, you can see that it's just a zip file containing an x86_64 executable.  The last bit of information given is that there is a public directory on the printer's filesystem that is accessible from the web server.

With this knowledge, we can create our own firmware by writing a simple C program to copy the desired log file to the directory accessible from the web server.  After compiling this program, we can zip it up and append the zip to the original.  Lastly, we can perform a hash extension attack to get a valid signature on our modified firmware image.  After uploading a json file containing the base64-encoded modified firmware image and the valid signature, we can just browse to the web server's public directory to retrieve the log file in question. 
